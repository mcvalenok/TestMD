# Описание REST API

Версия системы 2.0

Версия документа 1.

## Содержание

* [О компании Wallet](#о-компании-wallet)
* [Назначение документа](#назначение-документа)
* [Общие сведения](#общие-сведения)
* [Методы сервиса](#методы-сервиса)
   * [Метод 1](#метод-1)
   * [Метод 2](#метод-2)
   * [Метод создания платежа](#метод-создания-платежа)
        * [Пример тела запроса](#пример-тела-запроса)
        * [Параметры запроса](#параметры-запроса)
        * [Пример тела ответа](#пример-тела-ответа)
        * [Коды возврата](#коды-возврата)
* [Термины и определения](#термины-и-определения)
* [История документа](#история-документа)


## О компании Wallet

Компания [Wallet](https://wallet.com) предоставляет сервис электронных платежей. Компания насчитывает 
более 100500 партнеров из 150 стран мира. Благодаря данному сервису тысяча человек осуществляет миллион транзакций ежеминутно.

[comment]: # (считаю, у них есть сайт)

## Назначение документа

В документе представлены:

* общая информация о системе;
* описание методов с примерами;
* коды ошибок.

Документ предназначен для сотрудников компании GameFor, которые управляют объектами и ресурсами сервиса электронных платежей.

## Общие сведения

Сервис электронных платежей представляет собой систему, с помощью которой клиенты 
и контрагенты обмениваются денежными средствами. 

[comment]: # (мне дико не нравится это предложение, но у меня очень мало контекста)

Взаимодействие сторонних приложений с сервисом электронных платежей осуществляется с помощью POST-запросов по HTTP протоколу. Данные запроса и его результат передаются в JSON.

## Методы сервиса

### Метод 1

[comment]: # (раз добавлен новый метод, значит, уже какие-то существуют)

### Метод 2

### Метод создания платежа

_Метод позволяет создать платеж в сервисе электронных платежей._

`api/payout/request/`

#### Пример тела запроса

```
{ 
    "tsp": "Имя партнера",
    "сlient": "Уникальный код клиента",
    "оperationtype": "Тип операции",
    "Amount": 1000.50,
    "currency": "RUR",
    "details":[ 
        {
            "code": "kgjfkgjk",
            "amount": 50,
            "description": "транзакция1"
        },
        {
            "code": "ogkrogr",
            "amount": 50,
            "description": "тразакция2"
        },
        {
            "code": "fkgfgfgf",
            "amount": 30.10,
            "description": "транзакция3"
        }
    ],
    "channels":[
        {
            "channel": "mobi",
            "schedule": "postponed"
        },
        {
            "channel": "contact",
            "schedule": "direct"
        }
    ]
    "successURL": "http://game.com/successpage.html",
    "failURL": "http://game.com/failpage.html",
    "postponedURL":"​ http://game.com/postponed.html​"
}
```

[comment]: # (Я сложила три числа и не получила сумму в 1000.50. Это норм?)

Каждый запрос может содержать информацию о нескольких отдельных транзакций. 
Для каждой транзакции указывается код детализации платежа со стороны контрагента и сумма транзакции.

#### Параметры запроса


| Параметр | Тип | Обязательный | Описание |
|--|:--:|:--:|--|
|tsp |string | Да|Уникальное имя партнера. |
|сlient  | string | Да | Уникальный код клиента. |
| оperationtype | string | Да |  Тип операции.|
| Amount |decimal  | Да | Сумма операции. |
|currency |string |Нет | Валюта платежа.|
| details|string | Да|Детали запроса. |
| code|string |Да | Код детализации платежа со стороны контрагента. Код может быть неуникальным. Код отображается в реестре. |
| amount | decimal|Да |Сумма отдельной транзакции. |
| description| string|Да |Описание транзакции. |
| channels|array |Да |Метод вывода. |
|channel |string | Да|Канал вывода. |
|schedule |string | Да| Тип вывода: direct — мгновенно; postponed — отложено.|
|successURL |string |Да |Ссылка на сайт контрагента в случае успешного вывода. |
|failURL |string |Да | Ссылка на сайт контрагента в случае неуспешного вывода.|
|postponedURL|string |Да |Ссылка на сайт контрагента после подтверждения пользователем отложенного вывода. |

[comment]: # (Я ж правильно понимаю, что в данном контексте партнер и контрагент — это одно и то же лицо?)
[comment]: # (Было указано в задании, что большинство имею тип string. Поэтому я немного пофантазировало, что может быть не string. А так, конечно, надо смотреть, как реализовано.)


#### Пример тела ответа

После обработки запроса система возвращает ответ с кодом запроса на вывод средств.
В теле ответа возвращается идентификатор.

```
{
    "reqid":"a3efg8h"
}    
```

Код актуален 10 минут. По истечению этого времени система возвращает ошибку `Timeout` при запросе с данным кодом.

#### Коды возврата

При неуспешном выполнении запроса система возвращает в теле ответа ошибку.

| Код ошибки| Описание |
|--|--|
|`IllegalFormat`| Неправильный формат.|
|`UnknownUser`|Неизвестный пользователь. |
|`UnknownChannel`|Платежный канал недоступен пользователю или указан неправельный канал.|
|`SecurityError`|Неправильный сертификат при запросе.|
|`ReqAlreadyUsed`|Запрос с таким кодом транзакции уже получен.|
|`Timeout`|Истекло время операции. |

## Термины и определения

_API_ — Application Programming Interface. Набор методов (функций), который программист может использовать для доступа к функциональности программного компонента (программы, модуля, библиотеки).

_REST_ — Representational State Transfer. Набор правил, по которым осуществляется обмен данными между различными приложениями сети. 

_HTTP_ — Hyper Text Transfer Protocol. Протокол передачи гипертекста. Является протоколом прикладного уровня стека TCP/IP.


## История документа

**Версия системы 1.0**

*Версия документа 1.*

Создание документа.

**Изменения с версии 1.0 до 2.0**

*Версия документа 1.*

Добавлен метод [Метод создания платежа](#метод-создания-платежа).


